/*! Built with http://stenciljs.com */
const{h:s}=window.App;import{k as t,l as a,m as e}from"./chunk-3b6e0310.js";class o{componentDidLoad(){e.send("app","view change password",t.getUser().sub)}async changePassword(){try{if(this.hasPasswordLengthError=(this.newPassword||"").length<6,this.hasDoesNotMatchError=this.newPassword!==this.confirmPassword,this.hasPasswordLengthError||this.hasDoesNotMatchError)return;this.loading=!0;const s=await fetch(`${a().API_BASE_URL}/account/changepassword`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json",Authorization:`Bearer ${t.getAccessToken()}`},body:JSON.stringify({oldPassword:this.currentPassword,newPassword:this.newPassword,confirmPassword:this.confirmPassword})});if(!s.ok)throw"Failed to process your request";{const a=await s.json();if(!a.access_token)throw"invalid login attempt";t.login(a.access_token),e.send("app","password changed",t.getUser().sub),this.onLogin.emit()}}catch(s){this.hasFailed=!0}this.loading=!1}render(){return s("div",{class:"loginwrapper"},s("div",{class:"alert alert-warning text-center"},"გთხოვთ შეცვალოთ პაროლი"),this.hasFailed?s("div",{class:"alert alert-danger text-center"},s("strong",null," დაფიქსირდა შეცდომა. ")):"",s("div",{class:"loader-wrapper"},this.loading?s("app-loader",null):""),s("input",{type:"password",class:"form-control",placeholder:"ახალი პაროლი",onKeyDown:async s=>13===s.keyCode?await this.changePassword():()=>{},value:this.newPassword,onInput:s=>this.newPassword=s.target.value}),this.hasPasswordLengthError?s("p",{class:"text-error"},"პაროლი უნდა იყოს მინიმუმ 6 სიმბოლო"):"",s("br",null),s("input",{type:"password",class:"form-control",placeholder:"გაიმეორეთ პაროლი",onKeyDown:async s=>13===s.keyCode?await this.changePassword():()=>{},value:this.confirmPassword,onInput:s=>this.confirmPassword=s.target.value}),this.hasDoesNotMatchError?s("p",{class:"text-error"},"პაროლი არ ემთხვევა"):"",s("br",null),s("a",{onClick:async()=>await this.changePassword(),class:"btn btn-primary loginbutton"},"დადასტურება"))}static get is(){return"app-change-password"}static get properties(){return{confirmPassword:{state:!0},currentPassword:{type:String,attr:"current-password"},hasDoesNotMatchError:{state:!0},hasFailed:{state:!0},hasPasswordLengthError:{state:!0},loading:{state:!0},newPassword:{state:!0}}}static get events(){return[{name:"onLogin",method:"onLogin",bubbles:!0,cancelable:!0,composed:!0}]}static get style(){return".loginwrapper{width:270px;margin:150px auto 0}.loginbutton{width:100%;border-radius:15px!important}.text-error{color:red}"}}class r{constructor(){this.hasFailed=!1,this.loading=!1}componentDidLoad(){e.send("app","view login")}login(){this.hasFailed=!1,this.loading=!0,fetch(`${a().API_BASE_URL}/account/login`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({Username:this.username,Password:this.password})}).then(s=>{if(401===s.status)throw"invalid login attempt";return s.json()}).then(s=>{if(!s.access_token)throw"invalid login attempt";t.login(s.access_token),this.shouldChangePassword=!t.getUser().passwordChanged,this.loading=!1,this.shouldChangePassword||this.onLogin.emit()}).catch(s=>{console.log("error: ",s),this.hasFailed=!0,this.loading=!1,this.password=""})}render(){return this.shouldChangePassword?s("app-change-password",{currentPassword:this.password}):s("div",{class:"loginwrapper"},this.hasFailed?s("div",{class:"alert alert-danger"},s("strong",null," არასწორი მომხმარებელი / პაროლი. ")):"",s("div",{class:"loader-wrapper"},this.loading?s("app-loader",null):""),s("input",{type:"text",class:"form-control",placeholder:"მომხმარებელი",value:this.username,onInput:s=>this.username=s.target.value}),s("br",null),s("input",{type:"password",class:"form-control",placeholder:"პაროლი",onKeyDown:s=>13===s.keyCode?this.login():()=>{},value:this.password,onInput:s=>this.password=s.target.value}),s("br",null),s("a",{onClick:()=>this.login(),class:"btn btn-primary loginbutton"},"ავტორიზაცია"))}static get is(){return"app-login"}static get properties(){return{hasFailed:{state:!0},loading:{state:!0},password:{state:!0},shouldChangePassword:{state:!0},username:{state:!0}}}static get events(){return[{name:"onLogin",method:"onLogin",bubbles:!0,cancelable:!0,composed:!0}]}static get style(){return".loginwrapper{width:270px;margin:150px auto 0}.loginbutton{width:100%;border-radius:15px!important}"}}export{o as AppChangePassword,r as AppLogin};